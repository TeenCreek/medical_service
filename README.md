# Medical Service

Это примитивный веб-сервис, реализующий функциональность Медицинской Информационной Системы (МИС). Проект построен на Django и Django REST Framework с использованием PostgreSQL, JWT-аутентификации, pytest для тестирования и Docker Compose для локального развертывания.

## Функциональность

- **Аутентификация:** Вход в систему по логину/паролю с использованием JWT-токенов.
- **Управление консультациями:** CRUD‑операции для консультаций (создание, редактирование, получение по id, удаление) с валидацией времени приёма и проверкой, что доктор и пациент не совпадают.
- **Поиск, фильтрация и сортировка:** Возможность поиска по ФИО врача и пациента, фильтрация по статусу консультации и сортировка по дате создания.
- **Система прав доступа:** Ролевой механизм, ограничивающий доступ к операциям в зависимости от роли пользователя (админ, доктор, пациент).
- **Поддержка нескольких клиник:** Возможность работы доктора в нескольких клиниках.

## Технологии

- **Backend:** Django, Django REST Framework
- **База данных:** PostgreSQL
- **Аутентификация:** JWT (через `djangorestframework-simplejwt`)
- **Тестирование:** pytest, pytest-django
- **Контейнеризация:** Docker, Docker Compose

## Локальное развертывание с Docker

Для удобного запуска проекта используется Docker Compose. Ниже приведены шаги для развертывания:

1. **Клонирование репозитория:**

   ```
   git clone git@github.com:TeenCreek/medical_service.git
   cd medical_service
   ```

2. **Настройка переменных окружения**

Создайте файл .env в корневой директории проекта (если используется) и задайте необходимые переменные, например:

```
SECRET_KEY=your-secret-key
DB_NAME=postgres
DB_USER=postgres
DB_PASSWORD=postgres
DB_HOST=db
DB_PORT=5432
```

3. **Запуск Docker Compose:**

Постройте и запустите контейнеры командой:

```
docker-compose up -d --build
```

4. **Применение миграций:**

После запуска контейнеров примените миграции внутри контейнера

```
docker-compose exec web python manage.py migrate
```

5. **Создание суперпользователя:**

```
docker-compose exec web python manage.py createsuperuser
```

6. **Доступ к приложению:**

Приложение будет доступно по адресу http://localhost:8000.

## Запуск тестов

Для запуска тестов выполните команду:

```
docker-compose exec web pytest
```

## Linting

Для проверки стиля кода используется docker-compose exec web flake8flake8.

```
docker-compose exec web flake8
```

## Структура проекта

- clinics/ – Модели и сериализаторы для работы с клиниками.
- consultations/ – Модели, сериализаторы, представления и разрешения для консультаций.
- users/ – Пользовательская модель, а также модели для доктора и пациента.
- tests/ – Интеграционные тесты, покрывающие основную бизнес-логику.
- docker-compose.yml – Конфигурация для Docker Compose.
- Dockerfile – Инструкции для сборки Docker-образа.

## Примеры API запросов

Получение JWT токена

```
{
    "username": "admin",
    "password": "password"
}
```

Создание консультации

```
{
    "start_time": "2025-03-10T10:00:00Z",
    "end_time": "2025-03-10T11:00:00Z",
    "status": "Waiting",
    "doctor": 1,
    "patient": 1
}
```

Получение списка консультаций

```
GET http://localhost:8000/api/v1/consultations/
```

Получение деталей консультации

```
GET http://localhost:8000/api/v1/consultations/1/
```

Обновление консультации

```
{
    "start_time": "2025-03-10T10:15:00Z",
    "end_time": "2025-03-10T11:15:00Z",
    "status": "Confirmed",
    "doctor": 1,
    "patient": 1
}
```
